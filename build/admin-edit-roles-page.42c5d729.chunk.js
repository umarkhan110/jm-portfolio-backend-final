"use strict";(self.webpackChunkjm_portfolio_backend=self.webpackChunkjm_portfolio_backend||[]).push([[2544],{92100:(se,y,t)=>{t.r(y),t.d(y,{default:()=>Q});var e=t(67294),a=t(68547),R=t(49656),P=t(87751),d=t(41580),S=t(29728),U=t(67838),Z=t(49066),j=t(185),E=t(7681),B=t(80831),D=t(67109),F=t(27361),L=t.n(F),M=t(97132),z=t(28834),N=t(11276),b=t(74571),K=t(11047),C=t(75515),G=t(64256),O=t(16364),$=t(45697),c=t.n($);const v=({disabled:r,role:s,values:n,errors:i,onChange:f,onBlur:m})=>{const{formatMessage:o}=(0,M.useIntl)();return e.createElement(d.x,{background:"neutral0",padding:6,shadow:"filterShadow",hasRadius:!0},e.createElement(E.K,{spacing:4},e.createElement(K.k,{justifyContent:"space-between"},e.createElement(d.x,null,e.createElement(d.x,null,e.createElement(C.Z,{fontWeight:"bold"},s?s.name:o({id:"global.details",defaultMessage:"Details"}))),e.createElement(d.x,null,e.createElement(C.Z,{textColor:"neutral500",variant:"pi"},s?s.description:o({id:"Settings.roles.form.description",defaultMessage:"Name and description of the role"})))),e.createElement(S.z,{disabled:!0,variant:"secondary"},o({id:"Settings.roles.form.button.users-with-role",defaultMessage:"{number, plural, =0 {# users} one {# user} other {# users}} with this role"},{number:s.usersCount}))),e.createElement(N.r,{gap:4},e.createElement(b.P,{col:6},e.createElement(O.o,{disabled:r,name:"name",error:i.name&&o({id:i.name}),label:o({id:"global.name",defaultMessage:"Name"}),onChange:f,onBlur:m,value:n.name||""})),e.createElement(b.P,{col:6},e.createElement(G.g,{disabled:r,label:o({id:"global.description",defaultMessage:"Description"}),name:"description",error:i.name&&o({id:i.name}),onChange:f,onBlur:m},n.description||"")))))};v.defaultProps={disabled:!1,role:null,values:{name:"",description:""}},v.propTypes={disabled:c().bool,errors:c().object.isRequired,onBlur:c().func.isRequired,onChange:c().func.isRequired,role:c().object,values:c().object};const H=v;var x=t(48474),T=t(53209);const V=T.Ry().shape({name:T.Z_().required(a.translatedErrors.required)});var W=t(25108);const J=()=>{const r=(0,a.useNotification)(),{formatMessage:s}=(0,M.useIntl)(),{params:{id:n}}=(0,R.useRouteMatch)("/settings/roles/:id"),[i,f]=(0,e.useState)(!1),m=(0,e.useRef)(),{lockApp:o,unlockApp:X}=(0,a.useOverlayBlocker)(),{trackUsage:Y}=(0,a.useTracking)(),{isLoading:k,data:w}=(0,x.U_)(n),{role:u,permissions:q,isLoading:A,onSubmitSucceeded:_}=(0,x.Dq)(n),ee=async g=>{try{o(),f(!0);const{permissionsToSend:l,didUpdateConditions:p}=m.current.getPermissions();await(0,a.request)(`/admin/roles/${n}`,{method:"PUT",body:g}),u.code!=="strapi-super-admin"&&(await(0,a.request)(`/admin/roles/${n}/permissions`,{method:"PUT",body:{permissions:l}}),p&&Y("didUpdateConditions")),m.current.setFormAfterSubmit(),_({name:g.name,description:g.description}),r({type:"success",message:{id:"notification.success.saved"}})}catch(l){W.error(l.response);const p=L()(l,"response.payload.message","An error occured"),h=L()(l,"response.payload.data.permissions[0]",p);r({type:"warning",message:h})}finally{f(!1),X()}},I=u.code==="strapi-super-admin";return e.createElement(j.o,null,e.createElement(a.SettingsPageTitle,{name:"Roles"}),e.createElement(B.Formik,{enableReinitialize:!0,initialValues:{name:u.name,description:u.description},onSubmit:ee,validationSchema:V,validateOnChange:!1},({handleSubmit:g,values:l,errors:p,handleChange:h,handleBlur:te})=>e.createElement("form",{onSubmit:g},e.createElement(U.T,{primaryAction:e.createElement(E.K,{horizontal:!0,spacing:2},e.createElement(S.z,{disabled:u.code==="strapi-super-admin",onClick:g,loading:i,size:"L"},s({id:"global.save",defaultMessage:"Save"}))),title:s({id:"Settings.roles.edit.title",defaultMessage:"Edit a role"}),subtitle:s({id:"Settings.roles.create.description",defaultMessage:"Define the rights given to the role"}),navigationAction:e.createElement(a.Link,{startIcon:e.createElement(D.Z,null),to:"/settings/roles"},s({id:"global.back",defaultMessage:"Back"}))}),e.createElement(Z.D,null,e.createElement(E.K,{spacing:6},e.createElement(H,{isLoading:A,disabled:I,errors:p,values:l,onChange:h,onBlur:te,role:u}),!k&&!A?e.createElement(d.x,{shadow:"filterShadow",hasRadius:!0},e.createElement(z.Z,{isFormDisabled:I,permissions:q,ref:m,layout:w})):e.createElement(d.x,{background:"neutral0",padding:6,shadow:"filterShadow",hasRadius:!0},e.createElement(a.LoadingIndicatorPage,null)))))))},Q=()=>{const r=(0,e.useMemo)(()=>({read:P.Z.settings.roles.read,update:P.Z.settings.roles.update}),[]),{isLoading:s,allowedActions:{canRead:n,canUpdate:i}}=(0,a.useRBAC)(r);return s?e.createElement(a.LoadingIndicatorPage,null):!n&&!i?e.createElement(R.Redirect,{to:"/"}):e.createElement(J,null)}}}]);
